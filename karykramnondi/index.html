<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<title>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡•ã‡§Ç‡§¶</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;margin:0;background:#f7f2ed;color:#2b0000;}
.app-header{
 background:linear-gradient(135deg,#5a0000,#8b0000);
 color:#ffd700;padding:15px;text-align:center;font-size:20px;font-weight:600;
}
.tabs{display:flex;}
.tabs button{flex:1;padding:12px;border:none;background:#fff;color:#5a0000;font-weight:500;}
.tabs button.active{background:#ffd700;}
.container{padding:12px;padding-bottom:80px;}
.card{
 background:#fff;border-radius:10px;padding:12px;margin:10px 0;
 box-shadow:0 2px 6px rgba(0,0,0,0.1);
 border-left:4px solid #8b0000;
 position:relative;
}
input,textarea{
 width:100%;padding:9px;margin:5px 0;border-radius:6px;
 border:1px solid #ccc;font-size:14px;box-sizing:border-box;
}
.primary-btn{
 background:linear-gradient(135deg,#8b0000,#5a0000);
 color:#ffd700;border:none;padding:11px;width:100%;
 border-radius:8px;font-size:15px;
}
.fab{
 position:fixed;bottom:18px;right:18px;
 background:linear-gradient(135deg,#8b0000,#5a0000);
 color:#ffd700;width:52px;height:52px;border-radius:50%;
 font-size:26px;border:none;
}
.date-wrap{position:relative;}
.date-placeholder{
 position:absolute;left:12px;top:10px;color:#888;
 pointer-events:none;font-size:14px;
}
.reminder-head{
 background:#fff;border:1px solid #8b0000;
 padding:10px;border-radius:8px;margin-top:8px;
 display:flex;justify-content:space-between;cursor:pointer;
}
.reminder-body{display:none;margin-top:10px;}
.rem-section{
 border:1px solid #ddd;border-radius:8px;padding:10px;margin:8px 0;
 display:flex;align-items:center;gap:10px;
}
.rem-left{flex:1;}
.rem-right{display:flex;gap:6px;align-items:center;}
.rem-right input{background:#eee;border:1px solid #ccc;padding:6px;border-radius:6px;}
.tickbox{width:22px;height:22px;}
.suggest-box{
 background:#fff;border:1px solid #ccc;border-radius:6px;
 display:none;position:absolute;width:100%;z-index:50;
 max-height:120px;overflow:auto;
}
.suggest-item{padding:6px;cursor:pointer;}
.suggest-item:hover{background:#ffe9a3;}
#toast{
 visibility:hidden;min-width:200px;background:#333;color:#fff;
 text-align:center;border-radius:6px;padding:10px;
 position:fixed;left:50%;bottom:30px;transform:translateX(-50%);
 font-size:14px;z-index:1000;
}
</style>
</head>
<body>

<div class="app-header">‚ú® ‡§™‡•Ç‡§ú‡§æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞...‚úçÔ∏è</div>

<div class="tabs">
<button id="tabNondi" class="active" onclick="showTab('list')">‡§®‡•ã‡§Ç‡§¶‡•Ä</button>
<button id="tabReport" onclick="showTab('report')">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</button>
</div>

<div class="container">

<div id="listTab"></div>

<div id="emptyState" style="display:none;text-align:center;margin-top:80px;">
  <h3>üìñ ‡§Ö‡§ú‡•Ç‡§® ‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§®‡§æ‡§π‡•Ä</h3>
  <button onclick="newEntry()" class="primary-btn" style="width:70%;margin:auto;">
    ‚ûï ‡§™‡§π‡§ø‡§≤‡•Ä ‡§™‡•Ç‡§ú‡§æ ‡§®‡•ã‡§Ç‡§¶ ‡§ï‡§∞‡§æ
  </button>
</div>

<div id="reportTab" style="display:none;" class="card">
<h3>Month Wise Report</h3>
<input type="month" id="monthPick" onchange="generateMonthReport()">
<h4 id="monthResult"></h4>
<h4>üèÜ Top Yajman</h4>
<h4 id="topYajman"></h4>
</div>

<!-- ADD / EDIT FORM -->
<div id="addTab" style="display:none;" class="card">

<div style="text-align:right;">
  <button onclick="showTab('list')" style="background:none;border:none;font-size:22px;color:#8b0000;">‚úñ</button>
</div>

<h3>‡§®‡§µ‡•Ä‡§® ‡§™‡•Ç‡§ú‡§æ</h3>

<div style="position:relative;">
<input id="pooja" placeholder="‡§™‡•Ç‡§ú‡§æ ‡§®‡§æ‡§µ *">
<div id="poojaSuggest" class="suggest-box"></div>
</div>

<div class="date-wrap">
  <input type="date" id="date">
  <span class="date-placeholder" id="datePh">‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§®‡§ø‡§µ‡§°‡§æ *</span>
</div>

<div class="date-wrap">
  <input type="time" id="time">
  <span class="date-placeholder" id="timePh">‡§µ‡•á‡§≥ (optional)</span>
</div>

<div style="position:relative;">
<input id="yajman" placeholder="‡§Ø‡§ú‡§Æ‡§æ‡§® ‡§®‡§æ‡§µ *">
<div id="yajmanSuggest" class="suggest-box"></div>
</div>

<input id="dakshina" placeholder="‡§¶‡§ï‡•ç‡§∑‡§ø‡§£‡§æ (optional)">
<textarea id="notes" placeholder="‡§®‡•ã‡§Ç‡§¶‡•Ä (optional)"></textarea>

<div class="reminder-head" onclick="toggleReminder()">
 üîî Reminder ‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ <span id="remArrow">‚ñº</span>
</div>

<div class="reminder-body" id="reminderBody">
  <div class="rem-section">
    <div class="rem-left">‡§§‡•ç‡§Ø‡§æ‡§ö ‡§¶‡§ø‡§µ‡§∂‡•Ä</div>
    <div class="rem-right">
      <input type="time" id="sameTime">
      <input type="checkbox" id="sameDay" class="tickbox">
    </div>
  </div>

  <div class="rem-section">
    <div class="rem-left">‡§è‡§ï ‡§¶‡§ø‡§µ‡§∏ ‡§Ü‡§ß‡•Ä</div>
    <div class="rem-right">
      <input type="time" id="beforeTime">
      <input type="checkbox" id="beforeDay" class="tickbox">
    </div>
  </div>

  <div class="rem-section">
    <div class="rem-left">Custom Date-Time</div>
    <div class="rem-right">
      <input type="datetime-local" id="customDateTime">
      <input type="checkbox" id="customRem" class="tickbox">
    </div>
  </div>
</div>

<input type="hidden" id="remData">
<br>
<button class="primary-btn" onclick="saveEntry()">Save</button>
</div>

</div>

<button class="fab" id="fabBtn" onclick="newEntry()">+</button>
<div id="toast"></div>

<script>
let data = JSON.parse(localStorage.getItem("rojnishiData")||"[]");
let editIndex = -1;
let remExpanded=false;

/* Toast */
function showToast(msg){
 let t=document.getElementById("toast");
 t.innerText=msg;
 t.style.visibility="visible";
 setTimeout(()=>t.style.visibility="hidden",2000);
}

/* Tabs */
function showTab(tab){
 listTab.style.display="none";
 reportTab.style.display="none";
 addTab.style.display="none";
 emptyState.style.display="none";
 fabBtn.style.display="block";

 tabNondi.classList.remove("active");
 tabReport.classList.remove("active");

 if(tab=="list"){
   listTab.style.display="block";
   tabNondi.classList.add("active");
   renderList();
 }
 if(tab=="report"){
   reportTab.style.display="block";
   tabReport.classList.add("active");
   generateCurrentMonth();
 }
}

/* Open blank form for NEW */
function newEntry(){
 editIndex = -1;
 openForm();
 clearForm();
}

/* Open form screen */
function openForm(){
 addTab.style.display="block";
 listTab.style.display="none";
 reportTab.style.display="none";
 emptyState.style.display="none";
 fabBtn.style.display="none";
}

/* Clear Form */
function clearForm(){
 pooja.value="";
 date.value="";
 time.value="";
 yajman.value="";
 dakshina.value="";
 notes.value="";
 remData.value="";

 datePh.style.display="block";
 timePh.style.display="block";

 sameDay.checked=false;
 beforeDay.checked=false;
 customRem.checked=false;
 sameTime.value="";
 beforeTime.value="";
 customDateTime.value="";
 reminderBody.style.display="none";
 remArrow.innerText="‚ñº";
 remExpanded=false;
}

/* Reminder Expand */
function toggleReminder(){
 remExpanded=!remExpanded;
 reminderBody.style.display=remExpanded?"block":"none";
 remArrow.innerText=remExpanded?"‚ñ≤":"‚ñº";
}

/* Collect Reminder */
function collectReminderData(){
 let rem=[];
 if(sameDay.checked) rem.push({type:"same",time:sameTime.value});
 if(beforeDay.checked) rem.push({type:"before",time:beforeTime.value});
 if(customRem.checked) rem.push({type:"custom",datetime:customDateTime.value});
 remData.value=JSON.stringify(rem);
}

/* Suggestions */
function saveRecent(key,name){
 let arr=JSON.parse(localStorage.getItem(key)||"[]");
 arr=arr.filter(n=>n!=name);
 arr.unshift(name);
 if(arr.length>5) arr.pop();
 localStorage.setItem(key,JSON.stringify(arr));
}

function showRecent(key,boxId,inputId){
 let arr=JSON.parse(localStorage.getItem(key)||"[]");
 let box=document.getElementById(boxId);
 box.innerHTML="";
 if(arr.length==0){box.style.display="none";return;}
 arr.slice(0,3).forEach(n=>{
  let div=document.createElement("div");
  div.className="suggest-item";
  div.innerText=n;
  div.onclick=()=>{
    document.getElementById(inputId).value=n;
    box.style.display="none";
  };
  box.appendChild(div);
 });
 box.style.display="block";
}
pooja.onfocus=()=>showRecent("recentPooja","poojaSuggest","pooja");
yajman.onfocus=()=>showRecent("recentYajman","yajmanSuggest","yajman");
pooja.onblur=()=>setTimeout(()=>poojaSuggest.style.display="none",200);
yajman.onblur=()=>setTimeout(()=>yajmanSuggest.style.display="none",200);

/* EDIT with confirmation */
function editEntry(index){
 if(!confirm("‡§π‡•Ä ‡§®‡•ã‡§Ç‡§¶ Edit ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•Ä ‡§Ü‡§π‡•á ‡§ï‡§æ?")) return;

 let e = data[index];
 editIndex = index;
 openForm();
 clearForm();

 pooja.value=e.pooja;
 date.value=e.date;
 time.value=e.time;
 yajman.value=e.yajman;
 dakshina.value=e.dakshina;
 notes.value=e.notes;

 datePh.style.display="none";
 if(e.time) timePh.style.display="none";
}

/* DELETE */
function deleteEntry(index){
 if(!confirm("‡§π‡•Ä ‡§®‡•ã‡§Ç‡§¶ Delete ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•Ä ‡§Ü‡§π‡•á ‡§ï‡§æ?")) return;
 data.splice(index,1);
 localStorage.setItem("rojnishiData",JSON.stringify(data));
 renderList();
}

/* SAVE */
function saveEntry(){
 [pooja,date,yajman].forEach(f=>f.style.border="1px solid #ccc");
 let valid=true;

 if(pooja.value.trim()==""){pooja.style.border="2px solid red";valid=false;}
 if(date.value.trim()==""){date.style.border="2px solid red";valid=false;}
 if(yajman.value.trim()==""){yajman.style.border="2px solid red";valid=false;}

 if(!valid){
   showToast("‚ö†Ô∏è ‡§™‡•Ç‡§ú‡§æ ‡§®‡§æ‡§µ, ‡§§‡§æ‡§∞‡•Ä‡§ñ, ‡§Ø‡§ú‡§Æ‡§æ‡§® ‡§®‡§æ‡§µ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á");
   return;
 }

 collectReminderData();

 let entry={
  pooja:pooja.value.trim(),
  date:date.value,
  time:time.value.trim(),
  yajman:yajman.value.trim(),
  dakshina:Number(dakshina.value||0),
  notes:notes.value,
  remData:remData.value
 };

 if(editIndex>=0){
   data[editIndex]=entry;
   editIndex=-1;
 } else {
   data.push(entry);
 }

 localStorage.setItem("rojnishiData",JSON.stringify(data));
 saveRecent("recentPooja",entry.pooja);
 saveRecent("recentYajman",entry.yajman);

 showToast("‚úîÔ∏è Saved Successfully");
 showTab('list');
}

/* LIST render */
function renderList(){
 listTab.innerHTML="";

 if(data.length==0){
   emptyState.style.display="block";
   fabBtn.style.display="none";
   return;
 }

 emptyState.style.display="none";
 fabBtn.style.display="block";

 let today=new Date();
 today.setHours(0,0,0,0);

 data.forEach((e,index)=>{
  let d=new Date(e.date);
  d.setHours(0,0,0,0);

  let status=(d<today)
   ? "<span style='color:green;font-weight:600;'>Completed</span>"
   : "<span style='color:orange;font-weight:600;'>Upcoming</span>";

  let fd=("0"+d.getDate()).slice(-2)+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+d.getFullYear().toString().slice(-2);

  let div=document.createElement("div");
  div.className="card";

  div.innerHTML=`
   <div style="display:flex;justify-content:space-between;">
     <b>${e.pooja}</b>
     <button onclick="editEntry(${index})"
      style="background:#ffd700;border:none;padding:4px 8px;border-radius:4px;">‚úèÔ∏è</button>
   </div>
   üë§ ${e.yajman}<br>
   üìÖ ${fd} ${e.time||""}<br>
   üí∞ ‚Çπ ${e.dakshina}<br>
   Status : ${status}

   <div style="text-align:right;margin-top:6px;">
     <button onclick="deleteEntry(${index})"
      style="background:#8b0000;color:#fff;border:none;padding:3px 8px;border-radius:4px;">üóë Delete</button>
   </div>
  `;
  listTab.appendChild(div);
 });
}

/* REPORT */
function generateCurrentMonth(){
 let now=new Date();
 monthPick.value=now.toISOString().slice(0,7);
 generateMonthReport();
}

function generateMonthReport(){
 let monthVal=monthPick.value;
 let totalDak=0,count=0;
 let yajTotals={};

 data.forEach(e=>{
  if(e.date.startsWith(monthVal)){
   totalDak+=e.dakshina;
   count++;
   yajTotals[e.yajman]=(yajTotals[e.yajman]||0)+e.dakshina;
  }
 });

 monthResult.innerHTML=`‡§è‡§ï‡•Ç‡§£ ‡§™‡•Ç‡§ú‡§æ: ${count}<br>‡§è‡§ï‡•Ç‡§£ ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£‡§æ: ‚Çπ ${totalDak}`;

 let topName="",topVal=0;
 for(let y in yajTotals){
   if(yajTotals[y]>topVal){topVal=yajTotals[y];topName=y;}
 }
 topYajman.innerHTML = topName ? `${topName} (‚Çπ ${topVal})` : "‚Äî";
}

/* INIT */
showTab('list');
</script>

</body>
</html>
