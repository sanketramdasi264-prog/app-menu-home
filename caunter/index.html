<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Premium Jap Counter</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root {
    --bg-maroon: #4A0404;
    --gold-yellow: #FFD700;
    --text-color: #ffffff;
}

body, html {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    font-family: 'Poppins', sans-serif;
    background-color: var(--bg-maroon);
    color: var(--text-color);
    overflow: hidden;
}

.app-container {
    max-width: 450px;
    margin: 0 auto;
    height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 15px;
    box-sizing: border-box;
}

/* Notification & Target Card */
.top-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 12px;
    border-radius: 15px;
    margin-bottom: 10px;
    text-align: center;
}

.target-input-group { 
    display: flex; justify-content: center; gap: 10px; margin-top: 5px;
}

.target-input-group input { 
    width: 70px; padding: 8px; border-radius: 8px; border: none; text-align: center; font-weight: bold;
}

.notif-test-btn {
    background: transparent; color: var(--gold-yellow); border: 1px solid var(--gold-yellow);
    padding: 4px 10px; border-radius: 10px; font-size: 10px; margin-top: 8px; cursor: pointer;
}

/* Jap Input */
.jap-input-box { display: flex; gap: 8px; margin-bottom: 15px; }
input[type="text"] { flex: 1; padding: 12px; border-radius: 12px; border: none; font-weight: 600; outline: none; }
.save-btn { background: var(--gold-yellow); color: #000; border: none; padding: 0 15px; border-radius: 12px; font-weight: 800; cursor: pointer; }

/* Counter Visual */
.display-area { position: relative; flex: 1; display: flex; justify-content: center; align-items: center; }
.mala-circle { position: relative; width: 260px; height: 260px; display: flex; justify-content: center; align-items: center; }
#mala-beads { position: absolute; width: 100%; height: 100%; transform: rotate(-90deg); }
.bead { position: absolute; width: 9px; height: 9px; background: rgba(255,255,255,0.2); border-radius: 50%; transition: 0.2s; }
.bead.active { background: var(--gold-yellow); box-shadow: 0 0 8px var(--gold-yellow); transform: scale(1.3); }

.counter-box {
    width: 140px; height: 140px; background: var(--gold-yellow); border-radius: 50%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    box-shadow: 0 0 20px rgba(0,0,0,0.5); z-index: 5; border: 4px solid #fff;
}
#currentCount { font-size: 55px; font-weight: 900; color: #000; line-height: 1; }
#currentNaamDisplay { font-size: 14px; color: #4A0404; font-weight: 800; }

/* Stats Display */
.stats-bar {
    display: flex; justify-content: space-around; background: rgba(0,0,0,0.4); padding: 12px; border-radius: 15px; margin-bottom: 15px;
}
.stat-item { text-align: center; }
.stat-item span { display: block; font-size: 11px; opacity: 0.8; }
.stat-v { font-size: 18px; font-weight: 800; color: var(--gold-yellow); }

/* Main Tap Button */
.controls-area { position: relative; padding-bottom: 10px; }
.reset-btn {
    position: absolute; top: -35px; left: 0; width: 55px; height: 55px; border-radius: 50%; border: 3px solid #fff;
    background: #444; color: #fff; font-size: 10px; font-weight: 800; cursor: pointer; z-index: 10;
}
.jap-main-btn {
    width: 100%; height: 90px; background: #fff; color: #4A0404; border: none; border-radius: 20px;
    font-size: 28px; font-weight: 900; box-shadow: 0 8px 15px rgba(0,0,0,0.5); cursor: pointer;
}
</style>
</head>
<body onclick="increment()">

<div class="app-container">
    <div class="top-card" onclick="event.stopPropagation()">
        <label style="font-size: 12px; font-weight: 600;">üéØ ‡§∞‡•ã‡§ú‡§ö‡•á ‡§ü‡§æ‡§∞‡•ç‡§ó‡•á‡§ü (‡§Æ‡§æ‡§≥‡§æ)</label>
        <div class="target-input-group">
            <input type="number" id="targetInput" placeholder="0" onchange="saveTarget()">
            <span id="targetStatus" style="font-size: 12px; align-self: center; color: var(--gold-yellow);">0/0 ‡§™‡•Ç‡§∞‡•ç‡§£</span>
        </div>
        <button class="notif-test-btn" onclick="sendInstantNotification()">üîî ‡§ö‡•á‡§ï ‡§ï‡§∞‡§æ ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§Ø‡•á‡§§‡•á ‡§ï‡§æ?</button>
    </div>

    <div class="jap-input-box" onclick="event.stopPropagation()">
        <input type="text" id="naamInput" placeholder="‡§ú‡§™‡§æ‡§ö‡•á ‡§®‡§æ‡§µ...">
        <button class="save-btn" onclick="switchJap()">‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ</button>
    </div>

    <div class="display-area">
        <div class="mala-circle">
            <div id="mala-beads"></div>
            <div class="counter-box">
                <div id="currentNaamDisplay">‡§∞‡§æ‡§Æ</div>
                <div id="currentCount">0</div>
                <div style="font-size: 10px; color: #000; font-weight: bold;">‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ</div>
            </div>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><span>‡§Æ‡§æ‡§≥‡§æ</span><span class="stat-v" id="malaCount">0</span></div>
        <div class="stat-item"><span>‡§Ü‡§ú‡§ö‡§æ ‡§ú‡§™</span><span class="stat-v" id="todayTotal">0</span></div>
        <div class="stat-item"><span>‡§è‡§ï‡•Ç‡§£ ‡§ú‡§™</span><span class="stat-v" id="lifeTotal">0</span></div>
    </div>

    <div class="controls-area">
        <button class="reset-btn" onclick="resetCurrent(event)">‡§∞‡§ø‡§∏‡•á‡§ü</button>
        <button class="jap-main-btn">‡§ú‡§™ ‡§Æ‡•ã‡§ú‡§æ</button>
    </div>
</div>

<audio id="bell" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>

<script>
let japData = JSON.parse(localStorage.getItem("japData")) || { "‡§∞‡§æ‡§Æ": 0 };
let currentNaam = localStorage.getItem("lastNaam") || "‡§∞‡§æ‡§Æ";
let lifeTotal = parseInt(localStorage.getItem("lifeTotal")) || 0;
let targetMalas = parseInt(localStorage.getItem("targetMalas")) || 0;

function init() {
    document.getElementById("naamInput").value = currentNaam;
    document.getElementById("targetInput").value = targetMalas || "";
    createMala();
    updateUI();
    askPermission();
    startNotificationLoop();
}

function createMala() {
    const beadsContainer = document.getElementById("mala-beads");
    beadsContainer.innerHTML = "";
    for (let i = 0; i < 108; i++) {
        const bead = document.createElement("div");
        bead.className = "bead";
        const angle = (i / 108) * 2 * Math.PI;
        const x = 130 + 115 * Math.cos(angle) - 4.5;
        const y = 130 + 115 * Math.sin(angle) - 4.5;
        bead.style.left = x + "px"; bead.style.top = y + "px";
        beadsContainer.appendChild(bead);
    }
}

function increment(e) {
    if (e && (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON')) return;

    let currentVal = (japData[currentNaam] || 0) + 1;
    lifeTotal++;

    if (currentVal >= 108) {
        const bell = document.getElementById("bell");
        bell.currentTime = 0;
        bell.play();
        currentVal = 0;
        if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
    } else {
        if (navigator.vibrate) navigator.vibrate(40);
    }

    japData[currentNaam] = currentVal;
    save();
    updateUI();
}

function saveTarget() {
    targetMalas = parseInt(document.getElementById("targetInput").value) || 0;
    localStorage.setItem("targetMalas", targetMalas);
    updateUI();
}

function switchJap() {
    let inputVal = document.getElementById("naamInput").value.trim();
    if (inputVal === "") return;
    currentNaam = inputVal;
    if (japData[currentNaam] === undefined) japData[currentNaam] = 0;
    save();
    updateUI();
}

function updateUI() {
    let count = japData[currentNaam] || 0;
    document.getElementById("currentCount").innerText = count;
    document.getElementById("currentNaamDisplay").innerText = currentNaam;
    document.getElementById("lifeTotal").innerText = lifeTotal;
    
    let mCount = Math.floor(lifeTotal / 108);
    document.getElementById("malaCount").innerText = mCount;
    document.getElementById("todayTotal").innerText = lifeTotal;

    document.getElementById("targetStatus").innerText = `${mCount}/${targetMalas} ‡§™‡•Ç‡§∞‡•ç‡§£`;

    const beads = document.querySelectorAll(".bead");
    beads.forEach((bead, index) => bead.classList.toggle("active", index < count));
}

function resetCurrent(e) {
    e.stopPropagation();
    if (confirm("‡§™‡•ç‡§∞‡§ó‡§§‡•Ä ‡§∞‡§ø‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•Ä ‡§ï‡§æ?")) {
        japData[currentNaam] = 0;
        lifeTotal = 0;
        save();
        updateUI();
    }
}

function save() {
    localStorage.setItem("japData", JSON.stringify(japData));
    localStorage.setItem("lastNaam", currentNaam);
    localStorage.setItem("lifeTotal", lifeTotal);
}

// --- Notification Logic ---

function askPermission() {
    if ("Notification" in window) {
        Notification.requestPermission();
    }
}

function sendInstantNotification() {
    if (Notification.permission === "granted") {
        new Notification("‡§®‡§æ‡§Æ ‡§ú‡§™", {
            body: "‡§õ‡§æ‡§®! ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§ö‡§æ‡§≤‡•Ç ‡§ù‡§æ‡§≤‡•á ‡§Ü‡§π‡•á.",
            icon: "https://cdn-icons-png.flaticon.com/512/2850/2850812.png"
        });
    } else {
        alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ù‡§∞ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® Allow ‡§ï‡§∞‡§æ.");
        askPermission();
    }
}

function startNotificationLoop() {
    // ‡§¶‡§∞ ‡•ß ‡§§‡§æ‡§∏‡§æ‡§®‡•á ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§≤ (‡§¨‡•Ö‡§ü‡§∞‡•Ä ‡§µ‡§æ‡§ö‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä)
    setInterval(() => {
        let hour = new Date().getHours();
        if (hour >= 6 && hour <= 22) { // ‡§∏‡§ï‡§æ‡§≥‡•Ä ‡•¨ ‡§§‡•á ‡§∞‡§æ‡§§‡•ç‡§∞‡•Ä ‡•ß‡•¶
            let mCount = Math.floor(lifeTotal / 108);
            if (mCount < targetMalas && Notification.permission === "granted") {
                new Notification("‡§Ü‡§ú‡§ö‡§æ ‡§ú‡§™ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡§æ", {
                    body: `‡§§‡•Å‡§Æ‡§ö‡•á ${targetMalas} ‡§Æ‡§æ‡§≥‡§æ‡§Ç‡§ö‡•á ‡§ü‡§æ‡§∞‡•ç‡§ó‡•á‡§ü ‡§Ö‡§ú‡•Ç‡§® ‡§¨‡§æ‡§ï‡•Ä ‡§Ü‡§π‡•á. ‡§ú‡§™ ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ.`,
                });
            }
        }
    }, 60 * 60 * 1000); // Check every hour
}

init();
</script>
</body>
</html>

