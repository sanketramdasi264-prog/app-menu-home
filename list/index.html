<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium ‡§™‡•Ç‡§ú‡§æ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    :root { --primary: #c62828; --secondary: #ef6c00; --bg: #f5f5f5; }
    * { box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
    
    .app { max-width: 500px; width: 100%; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    
    .input-group { margin-bottom: 12px; }
    label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 4px; color: #444; }
    input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 14px; }

    .list-header { display: flex; font-weight: bold; background: #eee; padding: 10px; border-radius: 5px; margin-top: 10px; }
    .list-container { max-height: 350px; overflow-y: auto; border: 1px solid #eee; margin-bottom: 15px; }
    .list-item { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #f1f1f1; }
    .list-item input[type="checkbox"] { width: 22px; height: 22px; margin-right: 12px; accent-color: var(--primary); }
    .item-text { flex: 2; border: none; background: transparent; font-size: 15px; padding: 5px; width: 100%; }
    .qty-input { flex: 1; padding: 6px; border: 1px solid #ccc; border-radius: 4px; max-width: 90px; text-align: center; }

    .btn-add { background: #e8f5e9; color: #2e7d32; border: 2px dashed #2e7d32; padding: 10px; border-radius: 8px; font-size: 15px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 15px; transition: 0.3s; }
    .btn-add:hover { background: #c8e6c9; }

    .btn-main { background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 18px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 10px; }
    .btn-secondary { background: #444; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 15px; width: 100%; cursor: pointer; }

    #historyOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; display: none; flex-direction: column; padding: 20px; overflow-y: auto; }
    .history-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 15px; }
    .history-note { background: #fff3e0; border-left: 5px solid #ff9800; padding: 15px; font-size: 14px; color: #555; margin-bottom: 20px; border-radius: 5px; }
    .history-item { border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }

    #export-container { position: fixed; left: -99999px; top: 0; }
    .page-template { width: 2130px; height: 3231px; background: #ffffff; padding: 100px 140px; position: relative; overflow: hidden; }
    .page-content { height: 100%; display: flex; flex-direction: column; }
    .p-logo-box { position: absolute; top: 110px; right: 140px; width: 280px; height: 280px; }
    .p-logo-box img { width: 100%; height: 100%; object-fit: contain; }
    .p-ganesh { text-align: center; font-size: 60px; font-weight: bold; color: #c62828; margin-bottom: 25px; }
    .p-header { text-align: center; margin-bottom: 50px; width: 68%; margin-left: auto; margin-right: auto; }
    .p-header h1 { font-size: 95px; color: var(--primary); margin: 0 0 25px 0; text-decoration: underline; line-height: 1.2; }
    .p-info { font-size: 48px; margin-top: 25px; line-height: 1.4; color: #333; }
    .p-table-wrapper { flex: 1; min-height: 0; }
    .p-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .p-table th { background: #fdf2f2; padding: 30px 38px; text-align: left; border-bottom: 5px solid #333; font-size: 56px; color: #000; }
    .p-table td { padding: 26px 38px; border-bottom: 2px solid #eee; font-size: 50px; color: #000; }
    .p-footer { margin-top: auto; padding-top: 35px; text-align: center; border-top: 3px solid #ddd; display: flex; flex-direction: column; align-items: center; }
    .tip-text { font-size: 46px; font-weight: 600; color: #222; margin-bottom: 25px; }
    .page-capsule { background-color: #ffeb3b; color: #000; padding: 10px 40px; border-radius: 50px; font-size: 40px; font-weight: bold; display: inline-block; margin-top: 10px; border: 2px solid #fdd835; }
</style>
</head>
<body>

<div class="app">
    <h2 style="color:var(--primary); text-align:center; margin-top: 0;">üö© ‡§™‡•Ç‡§ú‡§æ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä</h2>
    
    <div class="input-group">
        <label>‡§™‡•Ç‡§ú‡•á‡§ö‡•á ‡§®‡§æ‡§µ:</label>
        <input type="text" id="poojaName" placeholder="‡§â‡§¶‡§æ. ‡§∂‡•ç‡§∞‡•Ä ‡§∏‡§§‡•ç‡§Ø‡§®‡§æ‡§∞‡§æ‡§Ø‡§£ ‡§Æ‡§π‡§æ‡§™‡•Ç‡§ú‡§æ">
    </div>
    <div class="input-group">
        <label>‡§Ü‡§ö‡§æ‡§∞‡•ç‡§Ø / ‡§ó‡•Å‡§∞‡•Å‡§ú‡•Ä‡§Ç‡§ö‡•á ‡§®‡§æ‡§µ:</label>
        <input type="text" id="guruName" placeholder="‡§â‡§¶‡§æ. ‡§∂‡•ç‡§∞‡•Ä _________ ‡§ó‡•Å‡§∞‡•Å‡§ú‡•Ä">
    </div>
    <div class="input-group">
        <label>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</label>
        <input type="text" id="contactNo" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞">
    </div>

    <div class="list-header">
        <div style="flex:2;">‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</div>
        <div style="flex:1; text-align:center;">‡§™‡•ç‡§∞‡§Æ‡§æ‡§£</div>
    </div>
    <div class="list-container" id="mainList"></div>

    <button class="btn-add" onclick="addNewItem()">‚ûï ‡§®‡§µ‡•Ä‡§® ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§ú‡•ã‡§°‡§æ (Add More)</button>

    <button class="btn-main" id="btnDownload" onclick="processExport()">üì• ‡§°‡§æ‡§ä‡§®‡§≤‡•ã‡§° & ‡§∂‡•á‡§Ö‡§∞</button>
    <button class="btn-secondary" onclick="toggleHistory(true)">üìú ‡§ú‡•Å‡§®‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä (History)</button>
</div>

<div id="historyOverlay">
    <div class="history-header">
        <h2 style="margin:0; color:var(--primary);">üìú ‡§ú‡•Å‡§®‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h2>
        <button onclick="toggleHistory(false)" style="padding:8px 15px; background:#eee; border:none; border-radius:5px; cursor:pointer;">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§æ ‚úñ</button>
    </div>
    <div class="history-note">
        üí° <b>‡§Æ‡§π‡§§‡•ç‡§§‡•ç‡§µ‡§æ‡§ö‡•Ä ‡§ü‡•Ä‡§™:</b> ‡§ú‡•Å‡§®‡•ç‡§Ø‡§æ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡•á‡§≤‡•ç‡§Ø‡§æ‡§∏, ‡§§‡•ç‡§Ø‡§æ ‡§µ‡•á‡§≥‡•Ä ‡§®‡§ø‡§µ‡§°‡§≤‡•á‡§≤‡•á ‡§Ü‡§Ø‡§ü‡§Æ‡•ç‡§∏ ‡§Ü‡§§‡§æ ‡§Ü‡§™‡•ã‡§Ü‡§™ ‡§ü‡§ø‡§ï ‡§Æ‡§æ‡§∞‡•ç‡§ï ‡§π‡•ã‡§§‡•Ä‡§≤.
    </div>
    <div id="historyListContent"></div>
</div>

<div id="export-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    const LOGO_URL = "1000894411 (1).png"; 
    let currentSamagri = ["‡§π‡§≥‡§¶", "‡§ï‡•Å‡§Ç‡§ï‡•Ç", "‡§Ö‡§¨‡§ø‡§∞", "‡§ó‡•Å‡§≤‡§æ‡§≤", "‡§∂‡•á‡§Ç‡§¶‡•Ç‡§∞", "‡§Ö‡§∑‡•ç‡§ü‡§ó‡§Ç‡§ß", "‡§Ö‡§§‡•ç‡§§‡§∞", "‡§Æ‡§ß", "‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞", "‡§ó‡§Ç‡§ó‡§æ‡§ú‡§≤", "‡§ó‡•Å‡§≤‡§æ‡§¨‡§™‡§æ‡§£‡•Ä", "‡§®‡§æ‡§°‡§æ‡§™‡•Å‡§°‡•Ä", "‡§ú‡§æ‡§®‡§µ‡•á ‡§ú‡•ã‡§°", "‡§≤‡§æ‡§≤ ‡§ï‡§™‡§°‡§æ", "‡§π‡§ø‡§∞‡§µ‡§æ ‡§ï‡§™‡§°‡§æ", "‡§™‡§æ‡§Ç‡§¢‡§∞‡§æ ‡§ï‡§™‡§°‡§æ", "‡§∏‡•Å‡§™‡§æ‡§∞‡•Ä", "‡§ñ‡§æ‡§∞‡•Ä‡§ï", "‡§¨‡§¶‡§æ‡§Æ", "‡§π‡§≥‡§ï‡•Å‡§Ç‡§°", "‡§Ö‡§ï‡•ç‡§∞‡•ã‡§°", "‡§∞‡§æ‡§Ç‡§ó‡•ã‡§≥‡•Ä", "‡§ï‡§æ‡§™‡•Ç‡§∞", "‡§ß‡•Ç‡§™", "‡§§‡§æ‡§Ç‡§¶‡•Ç‡§≥", "‡§ó‡•Å‡§≥", "‡§ñ‡•ã‡§¨‡§∞‡•á ‡§µ‡§æ‡§ü‡•Ä", "‡§®‡§æ‡§∞‡§≥", "‡§´‡•Å‡§≤‡§µ‡§æ‡§§‡•Ä", "‡§â‡§¶‡§¨‡§§‡•ç‡§§‡•Ä", "‡§ï‡§æ‡§™‡•Ç‡§∏", "‡§§‡•Ç‡§™", "‡§§‡•á‡§≤", "‡§ñ‡§°‡•Ä‡§∏‡§æ‡§ñ‡§∞", "‡§∏‡•Å‡§ü‡•á ‡§™‡•à‡§∏‡•á", "‡§µ‡§ø‡§°‡§æ ‡§™‡§æ‡§®‡•á", "‡§¶‡•Å‡§∞‡•ç‡§µ‡§æ", "‡§§‡•Å‡§≥‡§∏", "‡§¨‡•á‡§≤", "‡§´‡•Å‡§≤‡•á", "‡§π‡§æ‡§∞", "‡§´‡§≥‡•á", "‡§™‡§Ç‡§ö‡§æ‡§Æ‡•É‡§§", "‡§§‡§æ‡§Æ‡•ç‡§π‡§£", "‡§§‡§æ‡§Ç‡§¨‡•ç‡§Ø‡§æ", "‡§™‡§≥‡•Ä", "‡§™‡§Ç‡§ö‡§™‡§æ‡§§‡•ç‡§∞"];

    function init() {
        const container = document.getElementById('mainList');
        container.innerHTML = "";
        currentSamagri.forEach((item, index) => {
            addItemToUI(item, index);
        });
        updateHistoryList();
    }

    function addItemToUI(name, index) {
        const container = document.getElementById('mainList');
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `
            <input type="checkbox" id="chk-${index}">
            <input type="text" class="item-text" id="txt-${index}" value="${name}">
            <input type="text" class="qty-input" id="qty-${index}" placeholder="‡§™‡•ç‡§∞‡§Æ‡§æ‡§£">
        `;
        container.appendChild(div);
    }

    function addNewItem() {
        const newIndex = document.querySelectorAll('.list-item').length;
        addItemToUI("", newIndex);
        const listContainer = document.getElementById('mainList');
        listContainer.scrollTop = listContainer.scrollHeight;
        setTimeout(() => document.getElementById(`txt-${newIndex}`).focus(), 100);
    }

    function toggleHistory(show) {
        document.getElementById('historyOverlay').style.display = show ? 'flex' : 'none';
        if(show) updateHistoryList();
    }

    function saveToHistory(data) {
        let history = JSON.parse(localStorage.getItem('pooja_history') || '[]');
        const entry = { id: Date.now(), date: new Date().toLocaleString('mr-IN'), data: data };
        history.unshift(entry);
        localStorage.setItem('pooja_history', JSON.stringify(history.slice(0, 15)));
    }

    function updateHistoryList() {
        const historyListContent = document.getElementById('historyListContent');
        const history = JSON.parse(localStorage.getItem('pooja_history') || '[]');
        if(history.length === 0) {
            historyListContent.innerHTML = "<p style='text-align:center; color:#999; margin-top:50px;'>‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä.</p>";
            return;
        }
        historyListContent.innerHTML = history.map(h => `
            <div class="history-item" onclick="loadHistoryItem(${h.id})">
                <div>
                    <div style="font-weight:700; font-size:16px;">${h.data.poojaName.trim() || '‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä'}</div>
                    <div style="font-size:12px; color:#666;">üìÖ ${h.date}</div>
                    <div style="font-size:12px; color:var(--secondary);">üë§ ${h.data.guruName || '-'}</div>
                </div>
                <div style="color:var(--primary); font-weight:600;">‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ ‚ûî</div>
            </div>
        `).join('');
    }

    function loadHistoryItem(id) {
        const history = JSON.parse(localStorage.getItem('pooja_history') || '[]');
        const entry = history.find(h => h.id === id).data;
        document.getElementById('poojaName').value = entry.poojaName;
        document.getElementById('guruName').value = entry.guruName;
        document.getElementById('contactNo').value = entry.contactNo;
        const container = document.getElementById('mainList');
        container.innerHTML = "";
        entry.items.forEach((item, i) => {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <input type="checkbox" id="chk-${i}" ${item.checked ? 'checked' : ''}>
                <input type="text" class="item-text" id="txt-${i}" value="${item.name}">
                <input type="text" class="qty-input" id="qty-${i}" value="${item.qty || ''}" placeholder="‡§™‡•ç‡§∞‡§Æ‡§æ‡§£">
            `;
            container.appendChild(div);
        });
        toggleHistory(false);
        window.scrollTo({ top: 0, behavior: 'smooth' });
        alert("‡§®‡§ø‡§µ‡§°‡§≤‡•á‡§≤‡•Ä ‡§Ø‡§æ‡§¶‡•Ä ‡§≤‡•ã‡§° ‡§ù‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á!");
    }

    async function processExport() {
        const selected = [];
        const items = document.querySelectorAll('.list-item');
        items.forEach((itemDiv, i) => {
            const isChecked = document.getElementById(`chk-${i}`).checked;
            const name = document.getElementById(`txt-${i}`).value;
            const qty = document.getElementById(`qty-${i}`).value || "-";
            if(isChecked && name.trim() !== "") {
                selected.push({ name, qty });
            }
        });
        if(!selected.length) return alert("‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ!");
        
        const poojaNameVal = document.getElementById('poojaName').value;
        const poojaData = {
            poojaName: poojaNameVal,
            guruName: document.getElementById('guruName').value,
            contactNo: document.getElementById('contactNo').value,
            items: Array.from(items).map((_, i) => ({
                checked: document.getElementById(`chk-${i}`).checked,
                name: document.getElementById(`txt-${i}`).value,
                qty: document.getElementById(`qty-${i}`).value
            }))
        };
        saveToHistory(poojaData);

        const btn = document.getElementById('btnDownload');
        btn.innerHTML = "‚è≥ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§•‡§æ‡§Ç‡§¨‡§æ..."; btn.disabled = true;
        const container = document.getElementById('export-container');
        container.innerHTML = "";
        const itemsPerPage = 18;
        const totalPages = Math.ceil(selected.length / itemsPerPage);

        for (let i = 0; i < totalPages; i++) {
            const pageData = selected.slice(i * itemsPerPage, (i + 1) * itemsPerPage);
            const pageDiv = document.createElement('div');
            pageDiv.className = 'page-template';
            pageDiv.innerHTML = `
                <div class="page-content">
                    <div class="p-ganesh">‡•• ‡§∂‡•ç‡§∞‡•Ä ‡••</div>
                    <div class="p-logo-box"><img src="${LOGO_URL}" crossorigin="anonymous"></div>
                    <div class="p-header">
                        <h1>${poojaData.poojaName.trim() || "‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä"}</h1>
                        <div class="p-info"><b>‡§ó‡•Å‡§∞‡•Å‡§ú‡•Ä:</b> ${poojaData.guruName} | <b>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï:</b> ${poojaData.contactNo}</div>
                    </div>
                    <div class="p-table-wrapper">
                        <table class="p-table">
                            <thead><tr><th style="width:65%">‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</th><th style="width:35%">‡§™‡•ç‡§∞‡§Æ‡§æ‡§£</th></tr></thead>
                            <tbody>${pageData.map(item => `<tr><td>${item.name}</td><td>${item.qty}</td></tr>`).join('')}</tbody>
                        </table>
                    </div>
                    <div class="p-footer">
                        <div class="tip-text">üôè ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§∞‡•Ä‡§≤ ‡§∏‡§∞‡•ç‡§µ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§™‡•Ç‡§ú‡•á‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§∞‡•Ç‡§® ‡§†‡•á‡§µ‡§æ‡§µ‡•á üôè</div>
                        <div class="page-capsule">‡§™‡§æ‡§® ‡§ï‡•ç‡§∞. ${i + 1} / ${totalPages}</div>
                    </div>
                </div>`;
            container.appendChild(pageDiv);
            const canvas = await html2canvas(pageDiv, { scale: 1, useCORS: true });
            const link = document.createElement('a');
            link.download = `Pooja_List_P${i+1}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }
        btn.innerHTML = "üì• ‡§°‡§æ‡§ä‡§®‡§≤‡•ã‡§° & ‡§∂‡•á‡§Ö‡§∞"; btn.disabled = false;
    }
    init();
</script>
</body>
</html>
