<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium ‡§™‡•Ç‡§ú‡§æ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    :root { --primary: #c62828; --secondary: #ef6c00; --bg: #f5f5f5; }
    * { box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    
    .app { max-width: 500px; width: 100%; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 20px; }
    
    .input-group { margin-bottom: 12px; }
    label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 4px; color: #444; }
    input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 14px; }

    .list-header { display: flex; font-weight: bold; background: #eee; padding: 10px; border-radius: 5px; margin-top: 10px; }
    /* Scroll ‡§ï‡§æ‡§¢‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ñ‡§æ‡§≤‡•Ä‡§≤ ‡§¨‡§¶‡§≤ ‡§ï‡•á‡§≤‡§æ ‡§Ü‡§π‡•á */
    .list-container { margin-bottom: 15px; }
    .list-item { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #f1f1f1; }
    .list-item input[type="checkbox"] { width: 22px; height: 22px; margin-right: 12px; accent-color: var(--primary); }
    .item-text { flex: 2; border: none; background: transparent; font-size: 15px; padding: 5px; width: 100%; }
    .qty-input { flex: 1; padding: 6px; border: 1px solid #ccc; border-radius: 4px; max-width: 90px; text-align: center; }

    .btn-add { background: #e8f5e9; color: #2e7d32; border: 2px dashed #2e7d32; padding: 10px; border-radius: 8px; font-size: 15px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 15px; }
    .btn-main { background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 18px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 10px; }
    .btn-secondary { background: #444; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 15px; width: 100%; cursor: pointer; }

    /* Export Styles */
    #export-container { position: fixed; left: -9999px; top: 0; }
    .page-template { width: 2130px; height: 3231px; background: #fffaf0; padding: 120px 100px; position: relative; }
    .p-content { height: 100%; display: flex; flex-direction: column; }
    
    .p-ganesh { text-align: center; font-size: 70px; font-weight: bold; color: #c62828; margin-bottom: 10px; }
    .p-title { text-align: center; font-size: 130px; color: #c62828; margin: 0 0 20px 0; font-weight: 700; border-bottom: 6px solid #c62828; display: inline-block; width: 100%; }
    .p-header-info { text-align: center; font-size: 60px; margin-bottom: 50px; color: #333; }
    
    .p-list-area { display: flex; gap: 70px; flex-grow: 1; justify-content: center; align-items: flex-start; }
    .p-column { flex: 1; }
    .full-width { flex: 0 0 75%; }

    .p-table { width: 100%; border-collapse: collapse; background: #fff; }
    .p-table th { background: #ffe082; padding: 25px; font-size: 52px; border: 2px solid #444; text-align: left; }
    .p-table th:last-child { text-align: center; } 
    .p-table td { padding: 20px 25px; font-size: 46px; border: 1.5px solid #ccc; border-left: 2px solid #444; border-right: 2px solid #444; color: #000; line-height: 1.2; }
    .p-table td:last-child { text-align: center; } 
    .p-table tr:last-child td { border-bottom: 2px solid #444; }

    .p-footer { text-align: center; margin-top: auto; padding-top: 40px; padding-bottom: 20px; }
    .p-footer-text { font-size: 50px; font-weight: 600; color: #333; margin-bottom: 25px; }
    .p-page-num { background: #ffeb3b; padding: 15px 55px; border-radius: 60px; font-size: 42px; display: inline-block; font-weight: bold; border: 3px solid #fdd835; }
    
    .p-logo { position: absolute; top: 110px; right: 120px; width: 320px; height: 320px; object-fit: contain; }

    #historyOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; display: none; flex-direction: column; padding: 20px; overflow-y: auto; }
</style>
</head>
<body>

<div class="app">
    <h2 style="color:var(--primary); text-align:center; margin-top: 0;">‡§™‡•Ç‡§ú‡§æ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä</h2>
    <div class="input-group"><label>‡§™‡•Ç‡§ú‡•á‡§ö‡•á ‡§®‡§æ‡§µ:</label><input type="text" id="poojaName" placeholder="‡§â‡§¶‡§æ. ‡§∂‡•ç‡§∞‡•Ä ‡§∏‡§§‡•ç‡§Ø‡§®‡§æ‡§∞‡§æ‡§Ø‡§£ ‡§Æ‡§π‡§æ‡§™‡•Ç‡§ú‡§æ"></div>
    <div class="input-group"><label>‡§Ü‡§ö‡§æ‡§∞‡•ç‡§Ø / ‡§ó‡•Å‡§∞‡•Å‡§ú‡•Ä‡§Ç‡§ö‡•á ‡§®‡§æ‡§µ:</label><input type="text" id="guruName" placeholder="‡§â‡§¶‡§æ. ‡§∂‡•ç‡§∞‡•Ä _________ ‡§ó‡•Å‡§∞‡•Å‡§ú‡•Ä"></div>
    <div class="input-group"><label>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</label><input type="text" id="contactNo" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞"></div>

    <div class="list-header"><div style="flex:2;">‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</div><div style="flex:1; text-align:center;">‡§™‡•ç‡§∞‡§Æ‡§æ‡§£</div></div>
    <div class="list-container" id="mainList"></div>
    
    <button class="btn-add" onclick="addNewItem()">‚ûï ‡§®‡§µ‡•Ä‡§® ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§ú‡•ã‡§°‡§æ</button>
    <button class="btn-main" id="btnDownload" onclick="processExport()">üì• ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§Ü‡§£‡§ø ‡§∂‡•á‡§Ö‡§∞</button>
    <button class="btn-secondary" onclick="toggleHistory(true)">üìú ‡§ú‡•Å‡§®‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</button>
</div>

<div id="historyOverlay">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--primary); padding-bottom:10px;">
        <h2 style="margin:0; color:var(--primary);">üìú ‡§ú‡•Å‡§®‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h2>
        <button onclick="toggleHistory(false)" style="padding:8px 15px; background:#eee; border:none; border-radius:5px; cursor:pointer;">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§æ ‚úñ</button>
    </div>
    <div id="historyListContent" style="margin-top:20px;"></div>
</div>

<div id="export-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    const LOGO_URL = "1000894411 (1).png"; 
    let defaultItems = ["‡§π‡§≥‡§¶", "‡§ï‡•Å‡§Ç‡§ï‡•Ç", "‡§Ö‡§¨‡§ø‡§∞", "‡§ó‡•Å‡§≤‡§æ‡§≤", "‡§∂‡•á‡§Ç‡§¶‡•Ç‡§∞", "‡§Ö‡§∑‡•ç‡§ü‡§ó‡§Ç‡§ß", "‡§Ö‡§§‡•ç‡§§‡§∞", "‡§Æ‡§ß", "‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞", "‡§ó‡§Ç‡§ó‡§æ‡§ú‡§≤", "‡§ó‡•Å‡§≤‡§æ‡§¨‡§™‡§æ‡§£‡•Ä", "‡§®‡§æ‡§°‡§æ‡§™‡•Å‡§°‡•Ä", "‡§∏‡•Å‡§™‡§æ‡§∞‡•Ä", "‡§ñ‡§æ‡§∞‡•Ä‡§ï", "‡§¨‡§¶‡§æ‡§Æ", "‡§π‡§≥‡§ï‡•Å‡§Ç‡§°", "‡§Ö‡§ï‡•ç‡§∞‡•ã‡§°", "‡§∞‡§æ‡§Ç‡§ó‡•ã‡§≥‡•Ä", "‡§ï‡§æ‡§™‡•Ç‡§∞", "‡§ß‡•Ç‡§™", "‡§§‡§æ‡§Ç‡§¶‡•Ç‡§≥", "‡§®‡§æ‡§∞‡§≥", "‡§´‡•Å‡§≤‡§µ‡§æ‡§§‡•Ä", "‡§â‡§¶‡§¨‡§§‡•ç‡§§‡•Ä", "‡§§‡•Ç‡§™", "‡§§‡•á‡§≤", "‡§ñ‡§°‡•Ä‡§∏‡§æ‡§ñ‡§∞", "‡§µ‡§ø‡§°‡§æ ‡§™‡§æ‡§®‡•á", "‡§¶‡•Å‡§∞‡•ç‡§µ‡§æ", "‡§§‡•Å‡§≥‡§∏", "‡§¨‡•á‡§≤", "‡§´‡•Å‡§≤‡•á"];

    function init() {
        const container = document.getElementById('mainList');
        container.innerHTML = "";
        defaultItems.forEach((item, index) => addItemToUI(item, index));
        updateHistoryList();
    }

    function addItemToUI(name, index, checked = false, qty = "") {
        const container = document.getElementById('mainList');
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `<input type="checkbox" id="chk-${index}" ${checked ? 'checked' : ''}><input type="text" class="item-text" id="txt-${index}" value="${name}"><input type="text" class="qty-input" id="qty-${index}" value="${qty}" placeholder="‡§™‡•ç‡§∞‡§Æ‡§æ‡§£">`;
        container.appendChild(div);
    }

    function addNewItem() {
        const newIndex = document.querySelectorAll('.list-item').length;
        addItemToUI("", newIndex);
        setTimeout(() => document.getElementById(`txt-${newIndex}`).focus(), 100);
    }

    function toggleHistory(show) {
        document.getElementById('historyOverlay').style.display = show ? 'flex' : 'none';
        if(show) updateHistoryList();
    }

    function saveToHistory(data) {
        let history = JSON.parse(localStorage.getItem('pooja_history') || '[]');
        history.unshift({ id: Date.now(), date: new Date().toLocaleString('mr-IN'), data: data });
        localStorage.setItem('pooja_history', JSON.stringify(history.slice(0, 10)));
    }

    function updateHistoryList() {
        const content = document.getElementById('historyListContent');
        const history = JSON.parse(localStorage.getItem('pooja_history') || '[]');
        content.innerHTML = history.length === 0 ? "<p>‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á.</p>" : history.map(h => `
            <div style="border:1px solid #ddd; padding:15px; border-radius:10px; margin-bottom:10px; display:flex; justify-content:space-between; cursor:pointer;" onclick="loadHistoryItem(${h.id})">
                <div><b>${h.data.poojaName || '‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä'}</b><br><small>${h.date}</small></div>
                <div style="color:var(--primary);">‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ ‚ûî</div>
            </div>`).join('');
    }

    function loadHistoryItem(id) {
        const history = JSON.parse(localStorage.getItem('pooja_history') || '[]');
        const entry = history.find(h => h.id === id).data;
        document.getElementById('poojaName').value = entry.poojaName;
        document.getElementById('guruName').value = entry.guruName;
        document.getElementById('contactNo').value = entry.contactNo;
        const container = document.getElementById('mainList');
        container.innerHTML = "";
        entry.items.forEach((item, i) => addItemToUI(item.name, i, item.checked, item.qty));
        toggleHistory(false);
    }

    async function processExport() {
        const selected = [];
        const allRows = document.querySelectorAll('.list-item');
        allRows.forEach((_, i) => {
            if(document.getElementById(`chk-${i}`).checked) {
                // ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•á ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§†‡•á‡§µ‡§≤‡•Ä ‡§Ü‡§π‡•á
                selected.push({ name: document.getElementById(`txt-${i}`).value, qty: document.getElementById(`qty-${i}`).value || "" });
            }
        });

        if(!selected.length) return alert("‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ!");

        saveToHistory({
            poojaName: document.getElementById('poojaName').value,
            guruName: document.getElementById('guruName').value,
            contactNo: document.getElementById('contactNo').value,
            items: Array.from(allRows).map((_, i) => ({
                checked: document.getElementById(`chk-${i}`).checked,
                name: document.getElementById(`txt-${i}`).value,
                qty: document.getElementById(`qty-${i}`).value
            }))
        });

        const btn = document.getElementById('btnDownload');
        btn.innerHTML = "‚è≥ ‡§§‡§Ø‡§æ‡§∞ ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á..."; btn.disabled = true;

        const container = document.getElementById('export-container');
        container.innerHTML = "";

        const itemsPerPage = 46; 
        const totalPages = Math.ceil(selected.length / itemsPerPage);

        for (let p = 0; p < totalPages; p++) {
            const pageData = selected.slice(p * itemsPerPage, (p + 1) * itemsPerPage);
            const pageDiv = document.createElement('div');
            pageDiv.className = 'page-template';
            
            let listHTML = "";
            if (pageData.length <= 23) {
                listHTML = `<div class="p-column full-width">${renderTable(pageData)}</div>`;
            } else {
                const mid = Math.ceil(pageData.length / 2);
                listHTML = `<div class="p-column">${renderTable(pageData.slice(0, mid))}</div><div class="p-column">${renderTable(pageData.slice(mid))}</div>`;
            }

            pageDiv.innerHTML = `
                <div class="p-content">
                    <img src="${LOGO_URL}" class="p-logo" crossorigin="anonymous">
                    <div class="p-ganesh">‡•• ‡§∂‡•ç‡§∞‡•Ä ‡••</div>
                    <h1 class="p-title">${document.getElementById('poojaName').value || "‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä"}</h1>
                    <div class="p-header-info"><b></b> ${document.getElementById('guruName').value || "_______"} | <b>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï:</b> ${document.getElementById('contactNo').value || "_______"}</div>
                    <div class="p-list-area">${listHTML}</div>
                    <div class="p-footer">
                        <div class="p-footer-text">üôè ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§∞‡•Ä‡§≤ ‡§∏‡§∞‡•ç‡§µ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§™‡•Ç‡§ú‡•á‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§∞‡•Ç‡§® ‡§†‡•á‡§µ‡§æ‡§µ‡•á üôè</div>
                        <div class="p-page-num">‡§™‡§æ‡§® ‡§ï‡•ç‡§∞. ${p + 1} / ${totalPages}</div>
                    </div>
                </div>`;
            
            container.appendChild(pageDiv);
            const canvas = await html2canvas(pageDiv, { scale: 1, useCORS: true });
            
            // Download File
            const imageData = canvas.toDataURL("image/png");
            const link = document.createElement('a');
            link.download = `Pooja_List_P${p+1}.png`;
            link.href = imageData;
            link.click();

            // Share functionality (Mobile)
            try {
                const blob = await (await fetch(imageData)).blob();
                const file = new File([blob], `Pooja_List.png`, { type: 'image/png' });
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: '‡§™‡•Ç‡§ú‡§æ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä',
                        text: '‡§Ü‡§Æ‡§ö‡•Ä ‡§™‡•Ç‡§ú‡§æ ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä'
                    });
                }
            } catch (err) {
                console.log("Sharing not supported or cancelled");
            }
        }
        btn.innerHTML = "üì• ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§Ü‡§£‡§ø ‡§∂‡•á‡§Ö‡§∞"; btn.disabled = false;
    }

    function renderTable(data) {
        return `<table class="p-table"><thead><tr><th>‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</th><th style="width:30%">‡§™‡•ç‡§∞‡§Æ‡§æ‡§£</th></tr></thead><tbody>${data.map(item => `<tr><td>${item.name}</td><td>${item.qty}</td></tr>`).join('')}</tbody></table>`;
    }

    init();
</script>
</body>
</html>
