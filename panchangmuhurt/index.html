<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OmKarmyog ‚Äì Monthly Muhurt Share</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{ margin:0; font-family:'Noto Sans Devanagari',sans-serif; background:#f4f4f4; color:#333; }

/* HEADER STYLES */
.main-header {
  background: #4e0f0f; /* Dark Red Maroon */
  color: #ffd54f;      /* Gold text */
  padding: 12px 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.header-title { font-size: 20px; font-weight: bold; margin: 0; }
.edit-profile-btn {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid #ffd54f;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}

.page{ max-width:480px; margin:auto; padding:10px; }

/* MONTH CARD STYLES */
.month-title{
  background:#ffd54f;
  color:#8b0000;
  text-align:center;
  font-weight:bold;
  padding:10px;
  border-radius:8px;
  margin:15px 0 6px;
  font-size:16px;
}
.poster{
  background:#fff;
  border-radius:8px;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
  margin-bottom:12px;
}
.poster img.month-img{ width:100%; display:block; }
.share-btn{
  width:100%;
  background:#25D366;
  color:white;
  border:none;
  padding:14px;
  font-weight:bold;
  cursor:pointer;
  font-size:14px;
}

/* FINAL IMAGE USER BAR (The Exported Section) */
.user-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px;
  background:#4e0f0f;
  color:white;
  border-top: 3px solid #ffd54f;
}
.user-text{ font-size:14px; line-height:1.5; }
.user-text b{ color:#ffd54f; font-size: 18px; display: block; margin-bottom: 3px; }
.user-photo{ width:85px; height:105px; object-fit:cover; border-radius:6px; border:2px solid #ffd54f; }

/* MODAL STYLES */
.modal{ position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:99; }
.modal-content{ background:#fff; padding:20px; border-radius:12px; width:90%; max-width:400px; }
.modal-content input{ width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:5px; box-sizing: border-box; }
.save-btn{ background:#8b0000; color:#fff; border:none; padding:12px; border-radius:6px; width:100%; font-weight:bold; cursor:pointer; }

#temp-render { position: absolute; left: -9999px; top: 0; }
</style>
</head>

<body>

<header class="main-header">
    <div class="header-title">‡•ê ‡§ï‡§∞‡•ç‡§Æ‡§Ø‡•ã‡§ó</div>
    <button class="edit-profile-btn" onclick="openModal()">‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§¨‡§¶‡§≤‡§æ</button>
</header>

<div class="page">
  <div id="posters"></div>
</div>

<div id="temp-render"></div>

<div class="modal" id="userModal">
 <div class="modal-content">
   <h3 style="margin-top:0; color:#4e0f0f;">üìã ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§≠‡§∞‡§æ</h3>
   <input id="uName" placeholder="‡§§‡•Å‡§Æ‡§ö‡•á ‡§®‡§æ‡§µ">
   <input id="uOffice" placeholder="‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ">
   <input id="uAddress" placeholder="‡§™‡§§‡•ç‡§§‡§æ">
   <input id="uContact" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞">
   <div style="margin:10px 0;">
     <small>‡§§‡•Å‡§Æ‡§ö‡§æ ‡§´‡•ã‡§ü‡•ã ‡§®‡§ø‡§µ‡§°‡§æ:</small><br>
     <input id="uPhoto" type="file" accept="image/*" style="border:none; padding:5px 0;">
   </div>
   <button class="save-btn" onclick="saveUser()">‚úî ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§æ</button>
 </div>
</div>

<script>
const SAMPLE_IMG = "https://i.imgur.com/ZcLLrkY.png";

const months = [
 {title:"‡§ú‡§æ‡§®‡•á‡§µ‡§æ‡§∞‡•Ä ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§´‡•á‡§¨‡•ç‡§∞‡•Å‡§µ‡§æ‡§∞‡•Ä ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§Æ‡§æ‡§∞‡•ç‡§ö ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§è‡§™‡•ç‡§∞‡§ø‡§≤ ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§Æ‡•á ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§ú‡•Ç‡§® ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§ú‡•Å‡§≤‡•à ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§ë‡§ó‡§∏‡•ç‡§ü ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§∏‡§™‡•ç‡§ü‡•á‡§Ç‡§¨‡§∞ ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§ë‡§ï‡•ç‡§ü‡•ã‡§¨‡§∞ ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§®‡•ã‡§µ‡•ç‡§π‡•á‡§Ç‡§¨‡§∞ ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG},
 {title:"‡§°‡§ø‡§∏‡•á‡§Ç‡§¨‡§∞ ‡•®‡•¶‡•®‡•¨ ‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§", img:SAMPLE_IMG}
];

const postersDiv = document.getElementById("posters");
const modal = document.getElementById("userModal");
let userPhotoData = "";
let pendingIndex = null;

function buildPosters(){
  postersDiv.innerHTML="";
  months.forEach((m,i)=>{
    let div=document.createElement("div");
    div.innerHTML=`
      <div class="month-title">${m.title}</div>
      <div class="poster">
        <img class="month-img" src="${m.img}" crossOrigin="anonymous">
        <button class="share-btn" id="btn-${i}" onclick="handleShare(${i})">
          üì§ ‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä‡§∏‡§π ‡§∂‡•á‡§Ö‡§∞ ‡§ï‡§∞‡§æ
        </button>
      </div>
    `;
    postersDiv.appendChild(div);
  });
}

function openModal() {
  const saved = JSON.parse(localStorage.getItem("omk_userinfo"));
  if(saved) {
    document.getElementById("uName").value = saved.name || "";
    document.getElementById("uOffice").value = saved.office || "";
    document.getElementById("uAddress").value = saved.address || "";
    document.getElementById("uContact").value = saved.contact || "";
  }
  modal.style.display="flex";
}

function handleShare(index){
  pendingIndex = index;
  const saved = JSON.parse(localStorage.getItem("omk_userinfo"));
  if(saved){
    generateAndShare(index, saved);
  } else {
    modal.style.display="flex";
  }
}

document.getElementById("uPhoto").onchange = (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = () => userPhotoData = r.result;
  r.readAsDataURL(f);
};

function saveUser(){
  const data = {
    name: document.getElementById("uName").value.trim(),
    office: document.getElementById("uOffice").value.trim(),
    address: document.getElementById("uAddress").value.trim(),
    contact: document.getElementById("uContact").value.trim(),
    photo: userPhotoData || (JSON.parse(localStorage.getItem("omk_userinfo"))?.photo || "")
  };
  localStorage.setItem("omk_userinfo", JSON.stringify(data));
  modal.style.display="none";
  if(pendingIndex !== null) generateAndShare(pendingIndex, data);
}

async function generateAndShare(index, user){
  const btn = document.getElementById(`btn-${index}`);
  const originalText = btn.innerText;
  btn.innerText = "‚è≥ ‡§´‡•ã‡§ü‡•ã ‡§§‡§Ø‡§æ‡§∞ ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...";
  btn.disabled = true;

  const renderContainer = document.getElementById("temp-render");
  renderContainer.innerHTML = `
    <div id="export-target" style="width:500px; background:white; font-family:'Noto Sans Devanagari',sans-serif;">
      <img src="${months[index].img}" style="width:100%; display:block;" crossOrigin="anonymous">
      <div class="user-bar">
        <div class="user-text">
          <b>${user.name || '‡§Ü‡§™‡§≤‡•á ‡§®‡§æ‡§µ'}</b>
          ${user.office ? user.office + '<br>' : ''}
          ${user.address ? user.address + '<br>' : ''}
          ${user.contact ? '‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï: ' + user.contact : ''}
        </div>
        ${user.photo ? `<img class="user-photo" src="${user.photo}">` : ''}
      </div>
    </div>
  `;

  // Wait for photo rendering
  setTimeout(async () => {
    try {
      const canvas = await html2canvas(document.getElementById("export-target"), {
        scale: 2,
        useCORS: true
      });

      canvas.toBlob(blob => {
        const file = new File([blob], "OmKarmyog.png", {type: "image/png"});
        if(navigator.canShare && navigator.canShare({files: [file]})){
          navigator.share({ files: [file], title: "OmKarmyog Muhurt" });
        } else {
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "OmKarmyog_Muhurt.png";
          link.click();
        }
        btn.innerText = originalText;
        btn.disabled = false;
        renderContainer.innerHTML = "";
      }, "image/png");
    } catch(e) {
      alert("‡§ï‡§æ‡§π‡•Ä‡§§‡§∞‡•Ä ‡§§‡§æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§ï ‡§Ö‡§°‡§ö‡§£ ‡§Ü‡§≤‡•Ä.");
      btn.innerText = originalText;
      btn.disabled = false;
    }
  }, 600);
}

buildPosters();
</script>

</body>
</html>
